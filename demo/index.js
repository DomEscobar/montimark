!function(t){var n={};function r(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=n,r.d=function(t,n,e){r.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,n){if(1&n&&(t=r(t)),8&n)return t;if(4&n&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(r.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)r.d(e,i,function(n){return t[n]}.bind(null,i));return e},r.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(n,"a",n),n},r.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},r.p="",r(r.s=0)}([function(t,n,r){t.exports=r(2)},function(t,n,r){},function(t,n,r){"use strict";r.r(n);r(1);function e(t){if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,n){if(!t)return;if("string"===typeof t)return i(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(t,n)}(t))){var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var e,o,a=!0,u=!1;return{s:function(){e=t[Symbol.iterator]()},n:function(){var t=e.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==e.return||e.return()}finally{if(u)throw o}}}}function i(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function o(t,n){for(var r=0;r<n.length;r++){var e=n[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function a(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}var u=function(){function t(n,r){var e=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,"configurations",{opacity:1,crossOrigin:"*",rect:{w:null,h:null},position:{x:10,y:10}}),a(this,"orginals",[]);var o=document.querySelectorAll(n);i&&this.handleParams(i),this.showOriginals=this.showOriginals.bind(this),this.markImages=this.markImages.bind(this),this.watermark=this.watermark.bind(this),this.loadImage(r).then(function(t){e.markImages(o,t)}),document.monetization&&document.monetization.addEventListener("monetizationstart",function(){e.showOriginals(o)})}var n,r,i;return n=t,(r=[{key:"showOriginals",value:function(t){var n=this;t.forEach(function(t){var r=n.orginals.find(function(n){return n.id===t.getAttribute("markId")});r&&(t.src=r.src)})}},{key:"markImages",value:function(t,n){var r,i=this,o=this,a=e(t);try{var u=function(){var t=r.value;if(t instanceof HTMLImageElement){var e=i.randomUid();t.crossOrigin="*";var a={id:e,src:t.src};o.orginals.push(a),i.showGhostImage(t),i.loadImage(a.src).then(function(r){t.src=a.src;var o=i.drawImage(t);o=i.watermark(o,n),t.src=i.dataUrl(o),t.setAttribute("markId",e)})}};for(a.s();!(r=a.n()).done;)u()}catch(s){a.e(s)}finally{a.f()}}},{key:"showGhostImage",value:function(t){var n=t.height,r=t.width;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACUAAAAmCAIAAADMaMX6AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAzSURBVFhH7c1BEQAwEAOh+lcZKTXB3GsxwNutPqvP6rP6rD6rz+qz+qw+q8/qs/qs22/7cqJrk6NNXs8AAAAASUVORK5CYII=",t.height=n,t.width=r}},{key:"loadImage",value:function(t){var n=new Image;return n.crossOrigin=this.configurations.crossOrigin,new Promise(function(r){n.onload=function(){return r(n)},n.src=t})}},{key:"drawImage",value:function(t){var n=document.createElement("canvas"),r=n.getContext("2d");return n.width=t.width,n.height=t.height,r.drawImage(t,0,0,t.width,t.height),n}},{key:"watermark",value:function(t,n){var r=t.getContext("2d");return n.style.opacity=this.configurations.opacity,r.drawImage(n,this.configurations.position.x,this.configurations.position.y,this.configurations.rect.w||n.width,this.configurations.rect.h||n.height),t}},{key:"dataUrl",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"image/png",encoderOptions:.92};return t.toDataURL(n.type,n.encoderOptions)}},{key:"randomUid",value:function(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}},{key:"handleParams",value:function(t){this.configurations.rect=t.rect||this.configurations.rect,this.configurations.position=t.position||this.configurations.position}}])&&o(n.prototype,r),i&&o(n,i),t}();new function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),new u(".test","watermark.png",{opacity:.5,rect:{w:100,h:40},position:{x:10,y:10}})}}]);
//# sourceMappingURL=index.js.map