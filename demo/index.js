!function(t){var n={};function r(i){if(n[i])return n[i].exports;var e=n[i]={i:i,l:!1,exports:{}};return t[i].call(e.exports,e,e.exports,r),e.l=!0,e.exports}r.m=t,r.c=n,r.d=function(t,n,i){r.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,n){if(1&n&&(t=r(t)),8&n)return t;if(4&n&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var e in t)r.d(i,e,function(n){return t[n]}.bind(null,e));return i},r.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(n,"a",n),n},r.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},r.p="",r(r.s=0)}([function(t,n,r){t.exports=r(2)},function(t,n,r){},function(t,n,r){"use strict";r.r(n);r(1);function i(t){if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,n){if(!t)return;if("string"===typeof t)return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e(t,n)}(t))){var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o,a=!0,s=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}function e(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=t[r];return i}function o(t,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}var s=function(){function t(n,r){var i=this,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,"configurations",{opacity:1,crossOrigin:"*",rect:{w:null,h:null},position:{x:10,y:10},loader:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACUAAAAmCAIAAADMaMX6AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAzSURBVFhH7c1BEQAwEAOh+lcZKTXB3GsxwNutPqvP6rP6rD6rz+qz+qw+q8/qs/qs22/7cqJrk6NNXs8AAAAASUVORK5CYII="}),a(this,"orginals",[]);var o=document.querySelectorAll(n);e&&this.handleParams(e),this.showOriginals=this.showOriginals.bind(this),this.markImages=this.markImages.bind(this),this.watermark=this.watermark.bind(this),this.showGhostImage=this.showGhostImage.bind(this),this.loadImage=this.loadImage.bind(this),this.loadImage(r).then(function(t){i.markImages(o,t)}),document.monetization&&document.monetization.addEventListener("monetizationstart",function(){i.showOriginals(o)})}var n,r,e;return n=t,(r=[{key:"showOriginals",value:function(t){var n=this;t.forEach(function(t){var r=n.orginals.find(function(n){return n.id===t.getAttribute("markId")});r&&(t.src=r.src)})}},{key:"markImages",value:function(t,n){var r,e=this,o=this,a=i(t);try{var s=function(){var t=r.value;if(t instanceof HTMLImageElement){var i=e.randomUid();t.crossOrigin="*";var a={id:i,src:t.src};o.orginals.push(a),e.showGhostImage(t),e.loadImage(a.src).then(function(r){t.src=a.src;var o=e.drawImage(t);o=e.watermark(o,n),t.src=e.dataUrl(o),t.setAttribute("markId",i)})}};for(a.s();!(r=a.n()).done;)s()}catch(u){a.e(u)}finally{a.f()}}},{key:"showGhostImage",value:function(t){var n=t.height,r=t.width;t.src=this.configurations.loader,t.height=n,t.width=r}},{key:"loadImage",value:function(t){var n=new Image;return n.crossOrigin=this.configurations.crossOrigin,new Promise(function(r){n.onload=function(){return r(n)},n.src=t})}},{key:"drawImage",value:function(t){var n=document.createElement("canvas"),r=n.getContext("2d");return n.width=t.width,n.height=t.height,r.drawImage(t,0,0,t.width,t.height),n}},{key:"watermark",value:function(t,n){var r=t.getContext("2d");r.globalAlpha=this.configurations.opacity;var i=this.configurations.position.x,e=this.configurations.position.y,o=this.configurations.rect.w||n.width,a=this.configurations.rect.h||n.height;if("string"===typeof this.configurations.position.x&&"string"===typeof this.configurations.position.y){var s=t.height,u=t.width;i="left"===this.configurations.position.x?10:u-o,e="top"===this.configurations.position.y?10:s-a}return r.drawImage(n,i,e,o,a),t}},{key:"dataUrl",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"image/png",encoderOptions:.92};return t.toDataURL(n.type,n.encoderOptions)}},{key:"randomUid",value:function(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}},{key:"handleParams",value:function(t){this.configurations.rect=t.rect||this.configurations.rect,this.configurations.position=t.position||this.configurations.position,this.configurations.crossOrigin=t.crossOrigin||this.configurations.crossOrigin,this.configurations.opacity=t.opacity||this.configurations.opacity,this.configurations.loader=t.loader||this.configurations.loader}}])&&o(n.prototype,r),e&&o(n,e),t}();new function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),new s(".test","watermark.png",{loader:"loader.gif",opacity:1,rect:{w:120,h:80},position:{x:"right",y:"bottom"}})}}]);
//# sourceMappingURL=index.js.map