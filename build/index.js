/*!
 * 
 *   montimark v1.0.3
 *   https://github.com/domEscobar/montimark
 * 
 *   Copyright (c) Dominic H. (https://github.com/domEscobar)
 * 
 *   This source code is licensed under the MIT license found in the
 *   LICENSE file in the root directory of this source tree.
 *   
 */
!function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define("MontiMark",[],t):"object"===typeof exports?exports.MontiMark=t():e.MontiMark=t()}(window,function(){return function(e){var t={};function __webpack_require__(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,r){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},__webpack_require__.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(__webpack_require__.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)__webpack_require__.d(r,n,function(t){return e[t]}.bind(null,n));return r},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";function _createForOfIteratorHelper(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"===typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(e,t)}(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,i,o=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){a=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw i}}}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.r(t);var n=function(){function Montimark(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Montimark),_defineProperty(this,"configurations",{opacity:1,crossOrigin:"*",rect:{w:null,h:null},position:{x:10,y:10},loader:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACUAAAAmCAIAAADMaMX6AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAzSURBVFhH7c1BEQAwEAOh+lcZKTXB3GsxwNutPqvP6rP6rD6rz+qz+qw+q8/qs/qs22/7cqJrk6NNXs8AAAAASUVORK5CYII="}),_defineProperty(this,"orginals",[]);var i=document.querySelectorAll(e);n&&this.handleParams(n),this.showOriginals=this.showOriginals.bind(this),this.markImages=this.markImages.bind(this),this.watermark=this.watermark.bind(this),this.showGhostImage=this.showGhostImage.bind(this),this.loadImage(t).then(function(e){r.markImages(i,e)}),document.monetization&&document.monetization.addEventListener("monetizationstart",function(){r.showOriginals(i)})}var e,t,r;return e=Montimark,(t=[{key:"showOriginals",value:function(e){var t=this;e.forEach(function(e){var r=t.orginals.find(function(t){return t.id===e.getAttribute("markId")});r&&(e.src=r.src)})}},{key:"markImages",value:function(e,t){var r,n=this,i=this,o=_createForOfIteratorHelper(e);try{var a=function(){var e=r.value;if(e instanceof HTMLImageElement){var o=n.randomUid();e.crossOrigin="*";var a={id:o,src:e.src};i.orginals.push(a),n.showGhostImage(e),n.loadImage(a.src).then(function(r){e.src=a.src;var i=n.drawImage(e);i=n.watermark(i,t),e.src=n.dataUrl(i),e.setAttribute("markId",o)})}};for(o.s();!(r=o.n()).done;)a()}catch(s){o.e(s)}finally{o.f()}}},{key:"showGhostImage",value:function(e){var t=e.height,r=e.width;e.src=this.configurations.loader,e.height=t,e.width=r}},{key:"loadImage",value:function(e){var t=new Image;return t.crossOrigin=this.configurations.crossOrigin,new Promise(function(r){t.onload=function(){return r(t)},t.src=e})}},{key:"drawImage",value:function(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0,e.width,e.height),t}},{key:"watermark",value:function(e,t){var r=e.getContext("2d");r.globalAlpha=this.configurations.opacity;var n=this.configurations.position.x,i=this.configurations.position.y,o=this.configurations.rect.w||t.width,a=this.configurations.rect.h||t.height;if("string"===typeof this.configurations.position.x&&"string"===typeof this.configurations.position.y){var s=e.height,u=e.width;n="left"===this.configurations.position.x?10:u-o,i="top"===this.configurations.position.y?10:s-a}return r.drawImage(t,n,i,o,a),e}},{key:"dataUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"image/png",encoderOptions:.92};return e.toDataURL(t.type,t.encoderOptions)}},{key:"randomUid",value:function(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}},{key:"handleParams",value:function(e){this.configurations.rect=e.rect||this.configurations.rect,this.configurations.position=e.position||this.configurations.position,this.configurations.crossOrigin=e.crossOrigin||this.configurations.crossOrigin,this.configurations.opacity=e.opacity||this.configurations.opacity,this.configurations.loader=e.loader||this.configurations.loader}}])&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Montimark}();t.default=n}])});
//# sourceMappingURL=index.js.map